#!/bin/bash
#	Created by Volarics Istvan (Voli)

#:::::: Fix beallitasok :::::::
TAROLO="/var/lib/voli"
KIVETELEK=/etc/voli/smart_kivetelek
#:::::: Beallitasok :::::::::::
Referencia=${TAROLO}/Alap_
HDDK=$( ls /dev/sd[a-x]|sed 's/.*\///g;' )	#Ezekről készít
#:::::: Fuggvenyek ::::::::::::
AlapErtekFelvetel(){
	[ -d ${TAROLO} ] || mkdir -p ${TAROLO}
	for a in ${HDDK} ; do
		if [ ! -b /dev/${a} ]; then continue; fi
		echo $a
		smartctl --all "/dev/${a}"	>${Referencia}${a}
		if [ "$?" != "0" ]; then
			smartctl --all "/dev/${a}"
			echo "Visszatérési érték hiba: $?"
		fi
	done
}

Start(){
	for a in ${HDDK} ; do
		smartctl --all "/dev/${a}" >"${TAROLO}/${a}"
		SmartExitCode=$?

		ModelNev=$( grep -e "^Device Model:" "${TAROLO}/${a}" |sed 's/.*: //g; s/^ \+//g; ' )

		echo "----------------- ${a} --> ${ModelNev}	------------------"
		if [ $SmartExitCode -ne 0 ]; then
		    echo "SmartExitCode: $SmartExitCode."
		fi

		diff "${Referencia}${a}" "${TAROLO}/${a}" |grep -v -f "${KIVETELEK}"
	done
}


#:::::::: Start :::::::::::::::
case "$1" in
	alap)
		AlapErtekFelvetel
	;;
	*)
		Start
	;;
esac
exit 0
